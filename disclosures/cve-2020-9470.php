<html>

<?php include '../header.php';?>

<body>

<?php include '../navbar.php';?>

<div class="body-content">
    <h2>
        Local Privilege Escalation in Wing FTP Server (<= v6.2.5)
    </h2>
    <div class="center">
        <img class="headerpic" src="https://www.wftpserver.com/images/wingftp_logo.gif" alt="Hack the Planet" height="100px" width="100px" align="center">
    </div>
    <p class="date">2020-03-04</p>
    <h3>Description</h3>
    <p class="text">
        From the official website: Wing FTP Server is an easy-to-use, secure, and reliable FTP server software for Windows, Linux, Mac OS, and Solaris. It supports multiple file transfer protocols, including FTP, FTPS, HTTP, HTTPS, and SFTP, giving your clients flexibility in how they connect to the server. And it provides admins with a web-based interface to administrate the server from anywhere. You can also monitor server performance and online sessions and even receive email notifications about various events taking place on the server. </p>
    <p class="text">
        Download Link: <a href="https://www.wftpserver.com/download.htm">Wing FTP Server Software Downloads</a>
    </p>

        <h4>Vulnerability - CVE-2020-9470</h4>
        <p class="text">
            A weakness in the handling of HTTP sessions within Wing FTP Server allows any local user to escalate privileges to root on Linux, MacOS, and Solaris.  Exploitation is contingent on an already-established administrative session.
            It should be noted that version 6.2.5 was released on Februrary 27th, 2020, however, this bug was identified, reported, and patched on Februrary 28th, 2020.  Therefore, some installations of Wing FTP Server showing version 6.2.5 may be vulnerable, while some may not be vulnerable. 
        </p>
    <h3>Background</h3>
    <p class="text">
        To see previous bugs within Wing FTP Server and read how to install the software, please see the following article: <a href="cve-2020-8635.php">CVE-2020-8635</a>.
    </p>
    <h3>Attack Scenario</h3>    
    <h4>Unsafe handling of HTTP session cookies</h4>
    <p class="text">
        To track user sessions, on successful login, Wing FTP Server saves sessions as ".lua" files within the "/session" and "/session_admin" directories.  Some versions of 6.2.5 and prior are saved with world-readable and world-writeable permissions, which cause a session hijacking vulnerability.
        These ".lua" session files use the naming convention "&lt;cookie&gt;.lua" and are pinned to a specific source IP address.  Any local user may read the session cookie of a Wing FTP user or Wing FTP administrator.  In addition, a local user may modify the IP address to which that session is pinned, completely hijacking a session.
        The Wing FTP Server boasts a Lua interpreter within the administration panel (running by default on port 5466).  Since Wing FTP Server must run as a superuser, compromise of an administrative account results in root code execution on the server.
    </p>
    <h4>Screenshots</h4>
    <p class="text">
        Exploitation may also occur by hijacking a Wing FTP user account (to leverage the HTTP file transfer interface), but due to the presence of a Lua interpreter in the administrative interface, this target is more reliably exploited.
        Administrative sessions are stored within the "wftpserver/session_admin" directory.
        <img class="body-img" src="../img/wftpflow4a.png" />
        Because of the relaxed permissions on this session artifact, a local user may read the file name (which corresponds to the session cookie) and modify the IP restrictions.  In this case, the attacker is executing commands on the target server so the IP restriction is changed to localhost (127.0.0.1).
        <img class="body-img" src="../img/wftpflow4b.png" />
        A user may pass the session cookie to a browser, which authorizes them for the Wing FTP administrative interface, and then access the Lua interpreter, which executes the Lua programming language as root.  As can be seen in the following screenshot, this vulnerability is leveraged for root code execution. 
        <img class="body-img" src="../img/wftpflow4c.png" />
    </p>

    <h4>Exploit</h4>
    <p class="text">
        The exploitation of this vulnerability relies on an administrative session being established.  In addition, the UID_ADMIN cookies set by Wing FTP Server expire at the end of the "session", meaning that once a browser tab is closed, the cookie is invalidated. 
        This may only allow for an exploitation window of few minutes or seconds.  To resolve this issue, I created an exploit in bash that locates the Wing FTP Server session_admin directory, modifies the IP restrictions on the session file, then executes a Lua command from localhost with curl.
        The current payload creates a program in C to spawn a bash shell, compiles the program, then changes the owner to root and permissions to SUID to spawn a root shell.        
    </p>
    <a href="/disclosures/cve-2020-9470.sh">Link to Exploit</a>
    <a href="https://www.exploit-db.com/exploits/48154">(Updated) Exploit-DB</a>
    <img class="body-img" src="/img/wftpsploit2.png" />
    <br />
        <h4>Operating Systems Verified:</h4>
        <ul>
            <li>Ubuntu 18.04.1 LTS</li>
        </ul>
   
    </div>
     <?php include './policy.php';?>
</body>

<?php include '../footer.php';?>

</html>
